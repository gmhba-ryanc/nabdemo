<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Page NAB Form</title>
</head>
<body>

    <h2>Enter Payment Details</h2>
    
    <form id="nab-form">
        <label>Card Number:</label>
        <input type="text" id="EPS_CARDNUMBER" value="4444333322221111"><br>

        <label>Expiry Month:</label>
        <input type="text" id="EPS_EXPIRYMONTH" value="11"><br>

        <label>Expiry Year:</label>
        <input type="text" id="EPS_EXPIRYYEAR" value="28"><br>

        <label>CCV:</label>
        <input type="text" id="EPS_CardCCV" value="123"><br>

        <input type="hidden" id="CardType" value="VISA">
        <input type="hidden" id="CreditCardAccountName" value="John Doe">
        <input type="hidden" id="EPS_MERCHANT" value="ZBI0110">
        <input type="hidden" id="EPS_TYPE" value="CRN">
        <input type="hidden" id="EPS_ACTION" value="ADDCRN">
		
        <label>EPS_FINGERPRINT:</label>
        <input type="text" id="EPS_FINGERPRINT" value="935521648bcb226c5e44314a3c2793d6af91593aa3914153c1fe9b6428bf7a4b"><br>
		
		
        <label>EPS_TIMESTAMP:</label>
        <input type="text" id="EPS_TIMESTAMP" value="20250228042938"><br>
		
        <input type="hidden" id="EPS_RESULTURL" value="https://purple-plant-0e0badc00.6.azurestaticapps.net/index.html"><br>
		
        <label>EPS_CRN:</label>
        <input type="text" id="EPS_CRN" value="NEWCRN20250228042938">
        <input type="hidden" id="EPS_RESULTPARAMS" value="TRUE">
    </form>

    <button onclick="saveFormData()">Save & Continue</button>
    <button onclick="finalSubmit()">Final Submit</button>

    <p id="response-message"></p>

    <script>
        // Store form data in localStorage so it persists across steps
        function saveFormData() {
            let formData = {
                EPS_CARDNUMBER: document.getElementById("EPS_CARDNUMBER").value,
                EPS_EXPIRYMONTH: document.getElementById("EPS_EXPIRYMONTH").value,
                EPS_EXPIRYYEAR: document.getElementById("EPS_EXPIRYYEAR").value,
                EPS_CardCCV: document.getElementById("EPS_CardCCV").value,
                CardType: document.getElementById("CardType").value,
                CreditCardAccountName: document.getElementById("CreditCardAccountName").value,
                EPS_MERCHANT: document.getElementById("EPS_MERCHANT").value,
                EPS_TYPE: document.getElementById("EPS_TYPE").value,
                EPS_ACTION: document.getElementById("EPS_ACTION").value,
                EPS_FINGERPRINT: document.getElementById("EPS_FINGERPRINT").value,
                EPS_TIMESTAMP: document.getElementById("EPS_TIMESTAMP").value,
                EPS_RESULTURL: document.getElementById("EPS_RESULTURL").value,
                EPS_CRN: document.getElementById("EPS_CRN").value,
                EPS_RESULTPARAMS: document.getElementById("EPS_RESULTPARAMS").value
            };

            localStorage.setItem("nabFormData", JSON.stringify(formData));
            alert("Data saved! Proceed to the final step.");
        }

        // Final form submission using dynamic form submission
        function finalSubmit() {
            let formData = JSON.parse(localStorage.getItem("nabFormData"));
            if (!formData) {
                alert("No data found. Please fill in the form first.");
                return;
            }

            // Create a hidden form dynamically
            let form = document.createElement("form");
            form.method = "POST";
            form.action = "https://demo.transact.nab.com.au/directpost/crnmanage";

            for (const key in formData) {
                let input = document.createElement("input");
                input.type = "hidden";
                input.name = key;
                input.value = formData[key];
                form.appendChild(input);
            }

            document.body.appendChild(form);
            form.submit(); // Automatically submit the form
        }
    </script>

</body>
</html>
